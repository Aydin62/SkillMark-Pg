/* 
-- Droppers for development phase
DROP TABLE IF EXISTS USERS;
DROP TABLE IF EXISTS COURSES;
DROP TABLE IF EXISTS MODULES;
DROP TABLE IF EXISTS PROGRESS_LOGS;
*/

/* USERS */

CREATE TABLE USERS (
    USER_ID SERIAL PRIMARY KEY,
    /*
    FOR PG 13+:

    USER_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    */
    USER_NAME VARCHAR(100),
    SIGNUP_DATE DATE
);

/* COURSES */

CREATE TABLE COURSES (
    COURSE_ID SERIAL PRIMARY KEY,
    TITLE VARCHAR(100),
    CATEGORY VARCHAR(20),
    DIFFICULTY_LEVEL VARCHAR(20)
);

/* MODULES */

CREATE TABLE MODULES (
    MODULE_ID SERIAL PRIMARY KEY,
    COURSE_ID INT NOT NULL,  
    MODULE_TITLE VARCHAR(100),
    ORDER_IN_COURSE INT,
    FOREIGN KEY (COURSE_ID) REFERENCES COURSES(COURSE_ID) ON DELETE CASCADE 
);

/* PROGRESS_LOGS */

CREATE TABLE PROGRESS_LOGS (
    LOG_ID SERIAL PRIMARY KEY,
    USER_ID INT NOT NULL,
    MODULE_ID INT NOT NULL,
    STARTED_AT TIMESTAMP,
    COMPLETED_AT TIMESTAMP,
    TIME_SPENT_MINUTES INT,
    SCORE NUMERIC(3,1),
    CHECK (SCORE BETWEEN 0 AND 100),
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    FOREIGN KEY (MODULE_ID) REFERENCES MODULES(MODULE_ID) ON DELETE CASCADE
);